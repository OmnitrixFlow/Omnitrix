<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1920, height=1080, initial-scale=1.0">
    <title>Omnitrix Music Player</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Montserrat:wght@300;400;500;600;700&display=swap');

        /* FIX 1: NoeDisplay — new clock font */
        @font-face {
            font-family: 'NoeDisplay';
            src: url('fonts/GelisTeko-ow7v0.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --bg-primary: #121212;
            --bg-secondary: #181818;
            --text-primary: #ffffff;
            --text-secondary: #888888;
            --accent-cyan: #00d2ff;
            --accent-glow: rgba(0, 210, 255, 0.6);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.15);
        }

        html, body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            font-family: 'Montserrat', sans-serif;
            background: radial-gradient(circle at 20% 30%, rgba(0, 210, 255, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(0, 210, 255, 0.05) 0%, transparent 50%),
                        #121212;
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
        }

        /* Fixed Top Navigation */
        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 80px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, transparent 100%);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 60px;
            z-index: 1000;
        }

        .nav-links {
            display: flex;
            gap: 50px;
            align-items: center;
        }

        .nav-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: 3px;
            cursor: pointer;
            position: relative;
            padding: 10px 0;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-family: 'Orbitron', monospace;
        }

        .nav-btn.active { color: var(--accent-cyan); }

        .nav-btn.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--accent-cyan);
            box-shadow: 0 0 20px var(--accent-glow), 0 0 40px var(--accent-glow);
            animation: glow-pulse 2s ease-in-out infinite;
        }

        @keyframes glow-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .system-status { position: relative; }

        .status-trigger {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            transition: all 0.3s;
            opacity: 0.7;
        }

        .status-trigger:hover { opacity: 1; }
        .status-trigger svg { width: 24px; height: 24px; stroke: var(--text-primary); fill: none; stroke-width: 2; }

        .status-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            width: 280px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            opacity: 0;
            pointer-events: none;
            transform: translateY(-10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            z-index: 1001;
        }

        .status-dropdown.active { opacity: 1; pointer-events: all; transform: translateY(0); }

        .status-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-item:last-child { border-bottom: none; }
        .status-icon { width: 24px; height: 24px; flex-shrink: 0; }
        .status-icon svg { width: 100%; height: 100%; stroke: var(--text-primary); fill: none; stroke-width: 2; }
        .status-label { flex: 1; font-size: 0.95rem; color: var(--text-primary); font-weight: 500; }
        .status-indicator { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
        .status-indicator.green { background: #00ff00; box-shadow: 0 0 10px #00ff00; }
        .status-indicator.blue { background: #0099ff; box-shadow: 0 0 10px #0099ff; }
        .status-text { font-size: 0.85rem; color: var(--text-secondary); font-weight: 400; }

        .search-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 12px 25px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
        }

        .search-bar:focus-within {
            background: rgba(255, 255, 255, 0.12);
            border-color: var(--accent-cyan);
            box-shadow: 0 0 20px rgba(0, 210, 255, 0.3);
        }

        .search-icon { width: 20px; height: 20px; opacity: 0.6; stroke: var(--text-primary); }

        .search-input {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 0.95rem;
            width: 220px;
            outline: none;
            font-family: 'Montserrat', sans-serif;
        }

        .search-input::placeholder { color: var(--text-secondary); opacity: 0.6; }

        /* Horizontal Scroll Container */
        .scroll-container {
            position: absolute;
            top: 80px;
            left: 0;
            width: 100vw;
            height: calc(100vh - 80px);
            overflow-x: auto;
            overflow-y: hidden;
            scroll-snap-type: x mandatory;
            scroll-behavior: smooth;
            display: flex;
        }

        .scroll-container::-webkit-scrollbar { display: none; }

        .section {
            width: 100vw;
            height: 100%;
            flex-shrink: 0;
            scroll-snap-align: start;
            position: relative;
        }

        /* ==================== HOME ==================== */
        .home {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 80px;
            position: relative;
        }

        .clock-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 30px;
            padding: 80px 120px;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
            margin-bottom: 60px;
        }

        .clock-display {
            font-family: 'NoeDisplay', serif !important;
            font-size: 10rem;
            font-weight: 700;
            letter-spacing: 15px;
            background: linear-gradient(135deg, var(--accent-cyan) 0%, #ffffff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 20px;
        }

        .date-display {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            font-weight: 300;
            letter-spacing: 3px;
            color: var(--text-secondary);
            text-align: center;
        }

        /* Mini Player */
        .mini-player {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 900px;
            height: 110px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 55px;
            display: flex;
            align-items: center;
            padding: 15px 35px;
            gap: 30px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
        }

        .mini-player.active { opacity: 1; pointer-events: all; }

        .mini-album-art {
            width: 75px;
            height: 75px;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            animation: spin-slow 8s linear infinite;
        }

        @keyframes spin-slow { 100% { transform: rotate(360deg); } }

        .mini-content {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .marquee-container {
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .marquee-wrapper { display: inline-flex; white-space: nowrap; }
        .marquee-wrapper.scrolling { animation: marquee-scroll 20s linear infinite; }

        @keyframes marquee-scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .marquee-text { white-space: nowrap; }
        .marquee-text.duplicate { margin-left: 5ch; }
        .mini-title { font-size: 1rem; font-weight: 600; }

        /* =====================================================
           FIX 2: CLEAN FLAT PROGRESS BAR (replaces liquid wave)
           ===================================================== */

        /* Shared row wrapper */
        .progress-row {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
        }

        .progress-time {
            font-size: 0.75rem;
            font-family: 'Orbitron', monospace;
            color: var(--text-secondary);
            min-width: 38px;
            flex-shrink: 0;
            user-select: none;
        }

        .progress-time.right { text-align: right; }

        /* The outer hit-area wrapper (handles clicks/drags) */
        .progress-scrub {
            flex: 1;
            height: 20px;               /* large touch target */
            display: flex;
            align-items: center;
            cursor: pointer;
            position: relative;
        }

        /* Grey background track */
        .progress-track {
            width: 100%;
            height: 5px;
            background: #2e2e2e;
            border-radius: 3px;
            position: relative;
            overflow: visible;
        }

        /* Filled cyan portion */
        .progress-fill {
            height: 100%;
            background: var(--accent-cyan);
            border-radius: 3px;
            position: relative;
            transition: width 0.08s linear;
            min-width: 0;
        }

        /* Glowing thumb dot */
        .progress-thumb {
            position: absolute;
            right: -7px;
            top: 50%;
            transform: translateY(-50%);
            width: 14px;
            height: 14px;
            background: #ffffff;
            border: 2px solid var(--accent-cyan);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--accent-glow), 0 0 20px var(--accent-glow);
            pointer-events: none;
            flex-shrink: 0;
        }

        /* Main progress time labels */
        .main-times {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-family: 'Orbitron', monospace;
            margin-top: 8px;
        }

        /* =====================================================
           FIX 2: TOGGLE ICONS - consistent size
           ===================================================== */
        .control-btn.mode-toggle svg {
            width: 32px;
            height: 32px;
        }

        /* =====================================================
           FIX 3: SYNCED LYRICS
           ===================================================== */
        .lyrics-line {
            font-size: 1.5rem;
            line-height: 2;
            color: rgba(136,136,136,0.5);
            margin-bottom: 8px;
            font-weight: 300;
            letter-spacing: 0.5px;
            transition: color 0.4s ease, transform 0.4s ease, font-size 0.3s ease, font-weight 0.3s ease;
            transform-origin: left center;
        }

        .lyrics-line.active-lyric {
            color: var(--accent-cyan);
            font-weight: 600;
            font-size: 1.75rem;
            transform: scale(1.02);
            text-shadow: 0 0 20px rgba(0, 210, 255, 0.4);
        }

        .lyrics-line.near-lyric {
            color: rgba(255,255,255,0.5);
            font-weight: 400;
        }

        /* ==================== MUSIC PLAYER ==================== */
        .music-player {
            display: flex;
            height: 100%;
            padding: 80px;
            gap: 80px;
        }

        .player-left, .player-right {
            width: 50%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .player-left { justify-content: center; align-items: center; }

        .album-container {
            position: relative;
            width: 500px;
            height: 500px;
            margin-bottom: 30px;
        }

        .ambient-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(1.6);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            filter: blur(100px) saturate(2.5);
            opacity: 0.5;
            z-index: 0;
        }

        .album-art {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 20px;
            object-fit: cover;
            cursor: pointer;
            z-index: 1;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
        }

        .album-art.vinyl-mode {
            border-radius: 50%;
            animation: spin-vinyl 4s linear infinite;
        }

        @keyframes spin-vinyl { 100% { transform: rotate(360deg); } }

        .album-artist-container {
            width: 100%;
            max-width: 500px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .album-artist {
            font-size: 1.8rem;
            color: var(--text-secondary);
            font-weight: 400;
            letter-spacing: 1px;
        }

        .main-progress-container {
            width: 100%;
            margin-bottom: 40px;
        }

        /* FIX 3: Lyrics / Queue trigger buttons — active state feedback */
        .ctrl-lyrics,
        .ctrl-queue {
            opacity: 0.5;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .ctrl-lyrics.active,
        .ctrl-queue.active {
            opacity: 1;
        }

        .ctrl-queue img {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            object-fit: cover;
            display: block;
            box-shadow: 0 0 0 2px transparent;
            transition: box-shadow 0.3s ease;
        }

        .ctrl-queue.active img {
            box-shadow: 0 0 0 2px var(--accent-cyan);
        }

        .main-controls {
            display: flex;
            gap: 60px;
            align-items: center;
            justify-content: center;
        }

        .control-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            transition: all 0.3s ease;
            opacity: 0.7;
        }

        .control-btn:hover { opacity: 1; transform: scale(1.15); }
        .control-btn:active { transform: scale(0.95); }

        .control-btn svg {
            stroke: var(--text-primary);
            fill: none;
            stroke-width: 2;
            width: 40px;
            height: 40px;
        }

        .control-btn.play-pause svg {
            width: 60px;
            height: 60px;
            fill: var(--accent-cyan);
            stroke: none;
            filter: drop-shadow(0 0 10px var(--accent-glow));
        }

        .player-right {
            padding: 40px 0;
            justify-content: flex-start;
        }

        .track-header { margin-bottom: 30px; }

        .track-title-container { margin-bottom: 20px; overflow: hidden; }

        .track-title {
            font-size: 2.8rem;
            font-weight: 700;
            font-family: 'Orbitron', monospace;
            background: linear-gradient(90deg, var(--accent-cyan) 0%, #ffffff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .content-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .lyrics-view, .queue-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .lyrics-view { opacity: 1; transform: translateX(0); }
        .queue-view { opacity: 0; transform: translateX(50px); pointer-events: none; }

        .content-container.show-queue .lyrics-view { opacity: 0; transform: translateX(-50px); pointer-events: none; }
        .content-container.show-queue .queue-view { opacity: 1; transform: translateX(0); pointer-events: auto; }

        .lyrics-scroll {
            height: 100%;
            overflow-y: auto;
            padding: 40px 20px 40px 0;
            mask-image: linear-gradient(to bottom, transparent 0%, black 12%, black 88%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 12%, black 88%, transparent 100%);
            scroll-behavior: smooth;
        }

        .lyrics-scroll::-webkit-scrollbar { width: 6px; }
        .lyrics-scroll::-webkit-scrollbar-thumb { background: rgba(0, 210, 255, 0.3); border-radius: 4px; }

        .queue-list { height: 100%; overflow-y: auto; padding-right: 20px; }
        .queue-list::-webkit-scrollbar { width: 6px; }
        .queue-list::-webkit-scrollbar-thumb { background: rgba(0, 210, 255, 0.3); border-radius: 4px; }

        .queue-item {
            display: flex;
            gap: 25px;
            padding: 20px 25px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .queue-item:hover {
            background: rgba(0, 210, 255, 0.05);
            border-color: var(--accent-cyan);
            transform: translateX(10px);
        }

        .queue-item-thumb { width: 80px; height: 80px; border-radius: 10px; object-fit: cover; }

        .queue-item-info {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .queue-item-title {
            font-size: 1.2rem;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .queue-item-artist { font-size: 1rem; color: var(--text-secondary); font-weight: 300; }

        /* ==================== LIBRARY ==================== */
        .library { padding: 40px 80px; overflow-y: auto; }
        .library::-webkit-scrollbar { width: 8px; }
        .library::-webkit-scrollbar-thumb { background: rgba(0, 210, 255, 0.3); border-radius: 4px; }

        .library-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .playlist-card {
            display: flex;
            align-items: center;
            gap: 25px;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .playlist-card:hover {
            background: rgba(0, 210, 255, 0.05);
            border-color: var(--accent-cyan);
            transform: translateX(10px);
            box-shadow: 0 10px 40px rgba(0, 210, 255, 0.15);
        }

        .playlist-img { width: 120px; height: 120px; border-radius: 10px; object-fit: cover; flex-shrink: 0; }

        .playlist-title {
            flex: 1;
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Orbitron', monospace;
            letter-spacing: 0.5px;
        }

        /* Mini controls */
        .mini-controls { display: flex; gap: 20px; align-items: center; }

        .mini-control-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            transition: all 0.3s;
            opacity: 0.8;
        }

        .mini-control-btn:hover { opacity: 1; transform: scale(1.1); }
        .mini-control-btn svg { width: 24px; height: 24px; fill: var(--text-primary); }
        .mini-control-btn.play svg { width: 32px; height: 32px; }
    </style>
</head>
<body>
    <!-- Fixed Top Navigation -->
    <nav class="top-nav">
        <div class="nav-links">
            <button class="nav-btn active" data-section="0">HOME</button>
            <button class="nav-btn" data-section="1">MUSIC</button>
            <button class="nav-btn" data-section="2">LIBRARY</button>
        </div>
        <div class="nav-right">
            <div class="system-status">
                <button class="status-trigger" id="statusTrigger">
                    <svg viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m5.08 5.08l4.24 4.24M1 12h6m6 0h6M4.22 19.78l4.24-4.24m5.08-5.08l4.24-4.24"/>
                    </svg>
                </button>
                <div class="status-dropdown" id="statusDropdown">
                    <div class="status-item">
                        <div class="status-icon">
                            <svg viewBox="0 0 24 24"><path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><circle cx="12" cy="20" r="1"/></svg>
                        </div>
                        <span class="status-label">Network</span>
                        <div class="status-indicator green"></div>
                    </div>
                    <div class="status-item">
                        <div class="status-icon">
                            <svg viewBox="0 0 24 24"><path d="m6.5 6.5 11 11m-11 0 11-11"/><path d="M18 12a6 6 0 0 0-6-6 6 6 0 0 0-6 6"/></svg>
                        </div>
                        <span class="status-label">Bluetooth</span>
                        <div class="status-indicator blue"></div>
                    </div>
                    <div class="status-item">
                        <div class="status-icon">
                            <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>
                        </div>
                        <span class="status-label">Source</span>
                        <span class="status-text">MP3-LINK</span>
                    </div>
                </div>
            </div>
            <div class="search-bar">
                <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.35-4.35"/>
                </svg>
                <input type="text" class="search-input" placeholder="Search tracks, artists...">
            </div>
        </div>
    </nav>

    <div class="scroll-container" id="scrollContainer">
        <!-- SECTION 1: HOME -->
        <section class="section home">
            <div class="clock-card">
                <div class="clock-display" id="clockDisplay">00:00</div>
                <div class="date-display" id="dateDisplay">Loading...</div>
            </div>

            <div class="mini-player" id="miniPlayer">
                <img class="mini-album-art" id="miniAlbumArt" src="" alt="">
                <div class="mini-content">
                    <div class="marquee-container" id="miniTitleMarquee">
                        <div class="marquee-wrapper">
                            <span class="marquee-text mini-title">No track playing</span>
                            <span class="marquee-text mini-title duplicate" style="display:none">No track playing</span>
                        </div>
                    </div>
                    <!-- FIX 2: Clean flat progress bar (mini) -->
                    <div class="mini-progress-container">
                        <div class="progress-row">
                            <span class="progress-time" id="miniTimeLeft">0:00</span>
                            <div class="progress-scrub" id="miniProgressScrub">
                                <div class="progress-track">
                                    <div class="progress-fill" id="miniProgressFill" style="width:35%">
                                        <div class="progress-thumb"></div>
                                    </div>
                                </div>
                            </div>
                            <span class="progress-time right" id="miniTimeRight">0:00</span>
                        </div>
                    </div>
                </div>
                <div class="mini-controls">
                    <button class="mini-control-btn" id="miniPrevBtn">
                        <svg viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
                    </button>
                    <button class="mini-control-btn play" id="miniPlayBtn">
                        <svg viewBox="0 0 24 24" id="miniPlayIcon">
                            <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
                        </svg>
                    </button>
                    <button class="mini-control-btn" id="miniNextBtn">
                        <svg viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
                    </button>
                </div>
            </div>
        </section>

        <!-- SECTION 2: MUSIC PLAYER -->
        <section class="section music-player">
            <div class="player-left">
                <div class="album-container">
                    <img class="ambient-glow" id="ambientGlow" src="" alt="">
                    <img class="album-art" id="albumArt" src="" alt="Album Art">
                </div>
                <div class="album-artist-container">
                    <div class="marquee-container" id="albumArtistMarquee">
                        <div class="marquee-wrapper">
                            <span class="marquee-text album-artist">Artist Name</span>
                            <span class="marquee-text album-artist duplicate" style="display:none">Artist Name</span>
                        </div>
                    </div>
                </div>

                <!-- FIX 2: Clean flat main progress bar -->
                <div class="main-progress-container">
                    <div class="progress-scrub" id="mainProgressScrub">
                        <div class="progress-track">
                            <div class="progress-fill" id="mainProgressFill" style="width:35%">
                                <div class="progress-thumb" style="width:16px;height:16px;right:-8px;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="main-times">
                        <span id="currentTime">0:00</span>
                        <span id="totalDuration">0:00</span>
                    </div>
                </div>

                <div class="main-controls">
                    <!-- Far Left: Lyrics trigger — 4 horizontal lines, static -->
                    <button class="control-btn ctrl-lyrics" id="lyricsBtn" title="Show Lyrics">
                        <svg viewBox="0 0 24 24" width="32" height="32" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" xmlns="http://www.w3.org/2000/svg">
                            <line x1="3" y1="6"  x2="21" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                            <line x1="3" y1="14" x2="21" y2="14"/>
                            <line x1="3" y1="18" x2="21" y2="18"/>
                        </svg>
                    </button>

                    <button class="control-btn" id="prevBtn">
                        <svg viewBox="0 0 24 24"><path d="M19 20L9 12l10-8v16z"/><path d="M5 19V5"/></svg>
                    </button>
                    <button class="control-btn play-pause" id="playPauseBtn">
                        <svg viewBox="0 0 24 24" id="playIcon">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                    </button>
                    <button class="control-btn" id="nextBtn">
                        <svg viewBox="0 0 24 24"><path d="M5 4l10 8-10 8V4z"/><path d="M19 5v14"/></svg>
                    </button>

                    <!-- Far Right: Queue trigger — next track's album art thumbnail -->
                    <button class="control-btn ctrl-queue" id="queueBtn" title="Show Queue">
                        <img id="queueThumb" src="" alt="Next track"
                             width="32" height="32"
                             style="border-radius:4px; object-fit:cover; display:block;">
                    </button>
                </div>
            </div>

            <div class="player-right">
                <div class="track-header">
                    <div class="track-title-container">
                        <div class="marquee-container" id="trackTitleMarquee">
                            <div class="marquee-wrapper">
                                <span class="marquee-text track-title">Song Title</span>
                                <span class="marquee-text track-title duplicate" style="display:none">Song Title</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="content-container" id="contentContainer">
                    <div class="lyrics-view">
                        <!-- FIX 3: Lyrics scroll container with auto-scroll -->
                        <div class="lyrics-scroll" id="lyricsScroll"></div>
                    </div>
                    <div class="queue-view">
                        <div class="queue-list" id="queueList"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: LIBRARY -->
        <section class="section library">
            <div class="library-grid" id="libraryGrid"></div>
        </section>
    </div>

    <script>
        // ==================== STATE ====================
        const state = {
            currentTrack: {
                title: "Neon Odyssey",
                artist: "Synthwave Dreams feat. Electric Pulse",
                cover: "https://picsum.photos/seed/omni1/800/800",
                currentTime: 85,
                duration: 245,
                isPlaying: true
            },
            queue: [
                { title: "Electric Horizon",  artist: "Cyber Pulse",       cover: "https://picsum.photos/seed/omni2/800/800" },
                { title: "Quantum Dreams",    artist: "Digital Echo",       cover: "https://picsum.photos/seed/omni3/800/800" },
                { title: "Stellar Drift",     artist: "Space Cadets",       cover: "https://picsum.photos/seed/omni4/800/800" },
                { title: "Crystal Waves",     artist: "Chromatic",          cover: "https://picsum.photos/seed/omni5/800/800" },
                { title: "Void Runner",       artist: "Neon Collective",    cover: "https://picsum.photos/seed/omni6/800/800" },
                { title: "Data Stream",       artist: "Synth Matrix",       cover: "https://picsum.photos/seed/omni7/800/800" }
            ],
            playlists: [
                { title: "Synthwave Essentials", cover: "https://picsum.photos/seed/playlist1/800/800" },
                { title: "Cyberpunk Nights",     cover: "https://picsum.photos/seed/playlist2/800/800" },
                { title: "Retro Future",         cover: "https://picsum.photos/seed/playlist3/800/800" },
                { title: "Digital Dreams",       cover: "https://picsum.photos/seed/playlist4/800/800" },
                { title: "Neon Pulse",           cover: "https://picsum.photos/seed/playlist5/800/800" },
                { title: "Cosmic Journey",       cover: "https://picsum.photos/seed/playlist6/800/800" },
                { title: "Electric Sunrise",     cover: "https://picsum.photos/seed/playlist7/800/800" },
                { title: "Quantum Beats",        cover: "https://picsum.photos/seed/playlist8/800/800" },
                { title: "Vaporwave Vibes",      cover: "https://picsum.photos/seed/playlist9/800/800" },
                { title: "Techno Horizons",      cover: "https://picsum.photos/seed/playlist10/800/800"},
                { title: "Future Bass",          cover: "https://picsum.photos/seed/playlist11/800/800"},
                { title: "Chillwave Dreams",     cover: "https://picsum.photos/seed/playlist12/800/800"}
            ]
        };



        const scrollContainer    = document.getElementById('scrollContainer');
        const navBtns            = document.querySelectorAll('.nav-btn');
        const clockDisplay       = document.getElementById('clockDisplay');
        const dateDisplay        = document.getElementById('dateDisplay');
        const miniPlayer         = document.getElementById('miniPlayer');
        const miniAlbumArt       = document.getElementById('miniAlbumArt');
        const miniProgressFill   = document.getElementById('miniProgressFill');
        const miniTimeLeft       = document.getElementById('miniTimeLeft');
        const miniTimeRight      = document.getElementById('miniTimeRight');
        const albumArt           = document.getElementById('albumArt');
        const ambientGlow        = document.getElementById('ambientGlow');
        const lyricsScroll       = document.getElementById('lyricsScroll');
        const queueList          = document.getElementById('queueList');
        const libraryGrid        = document.getElementById('libraryGrid');
        const playPauseBtn       = document.getElementById('playPauseBtn');
        const playIcon           = document.getElementById('playIcon');
        const contentContainer   = document.getElementById('contentContainer');
        const modeSwitch         = null; // replaced by lyricsBtn + queueBtn below
        const currentTimeEl      = document.getElementById('currentTime');
        const totalDurationEl    = document.getElementById('totalDuration');
        const mainProgressFill   = document.getElementById('mainProgressFill');
        const statusTrigger      = document.getElementById('statusTrigger');
        const statusDropdown     = document.getElementById('statusDropdown');

        // ==================== HELPERS ====================
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${String(secs).padStart(2, '0')}`;
        }

        // ==================== SMART MARQUEE ====================
        function setupSmartMarquee(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            const wrapper = container.querySelector('.marquee-wrapper');
            const original = wrapper.querySelector('.marquee-text:first-child');
            const dupe     = wrapper.querySelector('.marquee-text.duplicate');

            function check() {
                wrapper.classList.remove('scrolling');
                dupe.style.display = 'none';
                if (original.scrollWidth > container.offsetWidth) {
                    dupe.style.display = 'inline';
                    wrapper.classList.add('scrolling');
                }
            }
            check();
            return check;
        }

        const miniTitleCheck   = setupSmartMarquee('miniTitleMarquee');
        const trackTitleCheck  = setupSmartMarquee('trackTitleMarquee');
        const albumArtistCheck = setupSmartMarquee('albumArtistMarquee');
        window.addEventListener('resize', () => {
            miniTitleCheck && miniTitleCheck();
            trackTitleCheck && trackTitleCheck();
            albumArtistCheck && albumArtistCheck();
        });

        // ==================== BUG 3: STATIC TOGGLE ICON ====================
        // Icon never changes — only the content view toggles.

        // ==================== FIX 4: TIMED LYRICS ====================
        const timedLyrics = [
            { time: 0,   text: "In the silence of the digital night" },
            { time: 10,  text: "Frequencies collide in streams of light" },
            { time: 20,  text: "Every pulse a memory reborn" },
            { time: 30,  text: "In this electric storm we're torn" },
            { time: 40,  text: "" },
            { time: 43,  text: "Neon signs illuminate the way" },
            { time: 53,  text: "Through circuits of yesterday" },
            { time: 63,  text: "In this endless cosmic maze" },
            { time: 73,  text: "We're dancing through the haze" },
            { time: 83,  text: "" },
            { time: 86,  text: "Omnitrix dreams are calling" },
            { time: 96,  text: "Through the void we're falling" },
            { time: 106, text: "Binary hearts are racing" },
            { time: 116, text: "Reality we're chasing" },
            { time: 126, text: "" },
            { time: 129, text: "Lost in waves of sound and time" },
            { time: 139, text: "Your signal merges into mine" },
            { time: 149, text: "Together in this endless night" },
            { time: 159, text: "We burn like neon light" },
            { time: 169, text: "" },
            { time: 172, text: "Electric pulses synchronize" },
            { time: 182, text: "In the matrix we arise" },
            { time: 192, text: "Every moment magnified" },
            { time: 202, text: "In this perpetual ride" }
        ];

        let lastActiveLyricIdx = -1;

        function buildLyrics() {
            lyricsScroll.innerHTML = timedLyrics.map((line, i) =>
                `<div class="lyrics-line" id="lyric-${i}">${line.text || '&nbsp;'}</div>`
            ).join('');
        }

        function getActiveLyricIndex(time) {
            let idx = 0;
            for (let i = 0; i < timedLyrics.length; i++) {
                if (time >= timedLyrics[i].time) idx = i;
                else break;
            }
            return idx;
        }

        function isMusicSectionVisible() {
            // The Music section is the 2nd panel (index 1). Check the horizontal
            // scroll position of the snap-container — NOT window.scrollY.
            const idx = Math.round(scrollContainer.scrollLeft / scrollContainer.clientWidth);
            return idx === 1;
        }

        function syncLyrics(force = false) {
            const idx = getActiveLyricIndex(state.currentTrack.currentTime);
            if (idx === lastActiveLyricIdx && !force) return;
            lastActiveLyricIdx = idx;

            // Always update highlight classes regardless of which page is visible
            const lines = lyricsScroll.querySelectorAll('.lyrics-line');
            lines.forEach((el, i) => {
                el.classList.remove('active-lyric', 'near-lyric');
                if (i === idx) el.classList.add('active-lyric');
                else if (Math.abs(i - idx) <= 2) el.classList.add('near-lyric');
            });

            // ONLY scroll the lyrics container if the Music page is actually visible.
            // Use manual scrollTop math — never scrollIntoView() which can hijack
            // the outer horizontal snap-container.
            if (!isMusicSectionVisible()) return;
            const activeLine = document.getElementById(`lyric-${idx}`);
            if (activeLine) {
                lyricsScroll.scrollTop =
                    activeLine.offsetTop
                    - (lyricsScroll.clientHeight / 2)
                    + (activeLine.clientHeight / 2);
            }
        }

        // ==================== FIX 2: SCRUBBERS ====================
        const mainProgressScrub = document.getElementById('mainProgressScrub');
        const miniProgressScrub = document.getElementById('miniProgressScrub');

        function applySeek(percent) {
            const p = Math.max(0, Math.min(100, percent));
            const newTime = (p / 100) * state.currentTrack.duration;
            state.currentTrack.currentTime = newTime;
            mainProgressFill.style.width = `${p}%`;
            miniProgressFill.style.width = `${p}%`;
            currentTimeEl.textContent = formatTime(newTime);
            miniTimeLeft.textContent  = formatTime(newTime);
            syncLyrics(true); // FIX 4: instant jump on scrub
        }

        function makeScrubber(scrubEl) {
            let active = false;
            scrubEl.addEventListener('pointerdown', e => {
                e.stopPropagation(); // BUG 2: never let this bubble to any parent click/nav handler
                active = true;
                scrubEl.setPointerCapture(e.pointerId);
                const r = scrubEl.getBoundingClientRect();
                applySeek(((e.clientX - r.left) / r.width) * 100);
            });
            scrubEl.addEventListener('pointermove', e => {
                if (!active) return;
                e.stopPropagation();
                const r = scrubEl.getBoundingClientRect();
                applySeek(((e.clientX - r.left) / r.width) * 100);
            });
            scrubEl.addEventListener('pointerup', e => {
                e.stopPropagation();
                active = false;
            });
            scrubEl.addEventListener('pointercancel', () => { active = false; });
            // Also block click from bubbling after a drag ends
            scrubEl.addEventListener('click', e => e.stopPropagation());
        }

        makeScrubber(mainProgressScrub);
        makeScrubber(miniProgressScrub);

        // ==================== PROGRESS UPDATE ====================
        function updateProgressBars() {
            const pct = (state.currentTrack.currentTime / state.currentTrack.duration) * 100;
            mainProgressFill.style.width = `${pct}%`;
            miniProgressFill.style.width = `${pct}%`;
            currentTimeEl.textContent = formatTime(state.currentTrack.currentTime);
            miniTimeLeft.textContent  = formatTime(state.currentTrack.currentTime);
        }

        // ==================== SYSTEM STATUS ====================
        statusTrigger.addEventListener('click', () => statusDropdown.classList.toggle('active'));
        document.addEventListener('click', e => {
            if (!statusTrigger.contains(e.target) && !statusDropdown.contains(e.target))
                statusDropdown.classList.remove('active');
        });

        // ==================== NAVIGATION ====================
        navBtns.forEach((btn, index) => {
            btn.addEventListener('click', () => {
                scrollContainer.scrollTo({ left: index * window.innerWidth, behavior: 'smooth' });
            });
        });

        scrollContainer.addEventListener('scroll', () => {
            const idx = Math.round(scrollContainer.scrollLeft / window.innerWidth);
            navBtns.forEach((btn, i) => btn.classList.toggle('active', i === idx));
        });

        // ==================== CLOCK ====================
        function updateClock() {
            const now = new Date();
            clockDisplay.textContent = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
            const days   = ['Dom','Lun','Mar','Mer','Gio','Ven','Sab'];
            const months = ['Gennaio','Febbraio','Marzo','Aprile','Maggio','Giugno','Luglio','Agosto','Settembre','Ottobre','Novembre','Dicembre'];
            dateDisplay.textContent = `${days[now.getDay()]} ${now.getDate()} ${months[now.getMonth()]}`;
        }
        updateClock();
        setInterval(updateClock, 1000);

        // ==================== PLAY/PAUSE ====================
        function updatePlayIcon() {
            const pausePath = '<path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>';
            const playPath  = '<path d="M8 5v14l11-7z"/>';
            const html = state.currentTrack.isPlaying ? pausePath : playPath;
            playIcon.innerHTML = html;
            document.getElementById('miniPlayIcon').innerHTML = html;
        }

        function togglePlay() {
            state.currentTrack.isPlaying = !state.currentTrack.isPlaying;
            updatePlayIcon();
            if (state.currentTrack.isPlaying) {
                miniPlayer.classList.add('active');
                albumArt.classList.add('vinyl-mode');
            } else {
                albumArt.classList.remove('vinyl-mode');
            }
        }

        playPauseBtn.addEventListener('click', togglePlay);
        document.getElementById('miniPlayBtn').addEventListener('click', togglePlay);
        albumArt.addEventListener('click', () => albumArt.classList.toggle('vinyl-mode'));

        // ==================== FIX 3: INDEPENDENT LYRICS / QUEUE TRIGGERS ====================
        const lyricsBtn  = document.getElementById('lyricsBtn');
        const queueBtn   = document.getElementById('queueBtn');
        const queueThumb = document.getElementById('queueThumb');

        function showLyrics() {
            contentContainer.classList.remove('show-queue');
            lyricsBtn.classList.add('active');
            queueBtn.classList.remove('active');
        }

        function showQueue() {
            contentContainer.classList.add('show-queue');
            queueBtn.classList.add('active');
            lyricsBtn.classList.remove('active');
        }

        lyricsBtn.addEventListener('click', showLyrics);
        queueBtn.addEventListener('click',  showQueue);

        // Set initial active state (lyrics shown by default)
        showLyrics();

        // ==================== RENDER TRACK ====================
        function renderTrack() {
            const t = state.currentTrack;
            albumArt.src      = t.cover;
            ambientGlow.src   = t.cover;
            miniAlbumArt.src  = t.cover;

            const miniTitleText = `${t.title} — ${t.artist}`;
            document.querySelectorAll('#miniTitleMarquee .marquee-text').forEach(el => el.textContent = miniTitleText);
            document.querySelectorAll('#trackTitleMarquee .marquee-text').forEach(el => el.textContent = t.title);
            document.querySelectorAll('#albumArtistMarquee .marquee-text').forEach(el => el.textContent = t.artist);

            totalDurationEl.textContent = formatTime(t.duration);
            miniTimeRight.textContent   = formatTime(t.duration);
            updateProgressBars();

            // FIX 3: Set queue button thumbnail to the first track in the queue
            if (queueThumb && state.queue.length > 0) {
                queueThumb.src = state.queue[0].cover;
                queueThumb.alt = state.queue[0].title;
            }

            if (t.isPlaying) {
                miniPlayer.classList.add('active');
                albumArt.classList.add('vinyl-mode');
            }
            updatePlayIcon();

            setTimeout(() => {
                miniTitleCheck   && miniTitleCheck();
                trackTitleCheck  && trackTitleCheck();
                albumArtistCheck && albumArtistCheck();
            }, 100);
        }

        // ==================== RENDER QUEUE ====================
        function renderQueue() {
            queueList.innerHTML = state.queue.map(t => `
                <div class="queue-item">
                    <img class="queue-item-thumb" src="${t.cover}" alt="${t.title}">
                    <div class="queue-item-info">
                        <div class="queue-item-title">${t.title}</div>
                        <div class="queue-item-artist">${t.artist}</div>
                    </div>
                </div>`).join('');
        }

        // ==================== RENDER LIBRARY ====================
        function renderLibrary() {
            libraryGrid.innerHTML = state.playlists.map(p => `
                <div class="playlist-card">
                    <img class="playlist-img" src="${p.cover}" alt="${p.title}">
                    <div class="playlist-title">${p.title}</div>
                </div>`).join('');
        }

        // ==================== PLAYBACK SIMULATION ====================
        setInterval(() => {
            if (state.currentTrack.isPlaying && state.currentTrack.currentTime < state.currentTrack.duration) {
                state.currentTrack.currentTime += 1;
                updateProgressBars();
                syncLyrics();
            }
        }, 1000);

        // ==================== INIT ====================
        buildLyrics();
        renderTrack();
        renderQueue();
        renderLibrary();
        // Initial lyrics sync — instant scroll to correct position
        setTimeout(() => syncLyrics(true), 150);
    </script>
</body>
</html>
